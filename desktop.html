<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Desktop Only</title>
    <style>
        /* --- 全局和基础样式 --- */
        * {
            -webkit-tap-highlight-color: transparent;
            /* 【新增】全局移除移动端点击高亮效果 */
        }

        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;

            /* --- 【修改】电脑端画中画背景设置 --- */
            background-color: #ffeef2;
            /* 这是一个淡粉色背景，你可以自己改 */
            display: flex;
            /* 开启Flex布局，为了居中 */
            justify-content: center;
            /* 水平居中 */
            align-items: center;
            /* 垂直居中 */
        }

        #phone-screen {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
            background-color: #fafafa;
        }

        /* 【新增】状态栏样式 */
        #status-bar {
            position: absolute;
            top: -15px;
            left: 0;
            width: 100%;
            height: 76px;
            /* 状态栏高度 */
            box-sizing: border-box;
            padding: 0 15px 0 35px;
            /* 【修改】增加了左侧内边距，让时间右移 */
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 15.6px !important;
            font-weight: 550 !important;
            color: #333;
            z-index: 100;
            pointer-events: none;
            /* 让状态栏不影响下层元素的点击 */
        }

        #status-bar-icons {
            display: flex;
            align-items: center;
            gap: 14.7px;
            /* 恢复到你最初感觉舒适的间距 */
        }

        /* 【全新】独立移动信号图标 */
        #status-bar-signal-icon {
            position: relative;
            /* 开启相对定位 */
            right: 0;
            /* 把它向右推8px，视觉上就是向左移动了 */
        }

        #status-bar-icons {
            display: flex;
            align-items: center;
            gap: 14.7px;
            /* 恢复到你最初感觉舒适的间距 */
        }

        /* 【全新】独立移动天气图标 */
        #status-bar-weather-icon {
            position: relative;
            /* 开启相对定位 */
            right: 0px;
            /* 把它向右推8px，视觉上就是向左移动了 */
        }

        #status-bar-battery-icon {
            position: relative;
            /* 开启相对定位 */
            top: 0;
            right: 4px;
            /* 把它向右推8px，视觉上就是向左移动了 */
        }

        #chat-interface-screen {
            display: flex;
            /* 核心1：让它成为flex布局的容器 */
            flex-direction: column;
            /* 核心2：让它的子元素（顶栏、消息区、底栏）垂直排列 */
            height: 100%;
            /* 确保它撑满整个屏幕 */
            position: relative;
            /* 保留position，为了背景伪元素 */
            z-index: 1;
        }

        #chat-interface-screen::before {
            /* 【全新】这才是我们真正的、唯一的背景层 */
            content: '';
            position: fixed;
            /* 使用fixed来模拟background-attachment，规避移动端bug */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
            z-index: -1;
            /* 把它放在父容器所有内容的后面 */
        }

        /* 【核心动画】新增一个淡入和放大的动画效果 */
        @keyframes fadeIn {
            from {
                opacity: 0;

            }

            to {
                opacity: 1;

            }
        }

        .screen {
            display: none;
            /* 默认不占据空间 */
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            flex-direction: column;
            box-sizing: border-box;
            background-color: #fafafa;
            opacity: 0;
            /* 默认透明 */
            visibility: hidden;
            /* 【关键】默认不可见，不阻挡交互 */

            /* --- 【V1.95 性能优化】--- */
            /* 提示浏览器，这个元素的 opacity 和 transform 属性将会变化，请进行硬件加速优化 */
            will-change: opacity, transform;
        }

        .screen.active {
            display: flex;
            /* 变为可见时，使用flex布局 */
            opacity: 1;
            /* 完全不透明 */
            visibility: visible;
            /* 【关键】变为可见，可以交互 */
            animation: fadeIn 0.4s ease-out;
            /* 【关键】只在变为 active 时播放动画 */
        }

        /* 分类开始 */

        /* --- 4.2 桌面 (#home-screen) --- */

        /* 桌面主容器 */
        #home-screen {
            position: relative;
            /* 保持相对定位基准，用于内部绝对定位元素的对齐 */
            width: 100%;
            height: 100%;
            /* 【核心修复】确保桌面与屏幕等高 */
            box-sizing: border-box;
            /* 确保padding不会撑大盒子 */
            overflow-y: auto;
            /* 核心：当内容超出时，允许垂直滚动 */
            background-color: #202020;
            padding: 90px 0 110px 0;
            /* 顶部为状态栏和灵动岛留空，底部为Dock栏留空 */
            opacity: 1;
            /* 【【【修改】】】让桌面默认透明，配合JS做淡入效果 */
            transition: opacity 0.3s ease-out, filter 0.3s ease-out;
            /* 为显示和模糊效果变化添加动画 */
            will-change: filter, opacity;
            /* 提示浏览器，优化动画性能 */
        }

        /* 
        ===================================================================
         【全新】V1.40 新桌面布局样式
        ===================================================================
        */

        /* --- 灵动岛 --- */
        #dynamic-island {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 160px;
            height: 36px;
            background-color: #000;
            border-radius: 18px;
            display: flex;
            align-items: center;
            padding: 4px;
            box-sizing: border-box;
            z-index: 20;
            /* 确保在最顶层 */
        }

        #dynamic-island .island-content {
            width: 24px;
            height: 24px;
            background-color: white;
            border-radius: 7px;
            margin-left: 8px;
            /* 【修正】向右移动5px, 您可以在此调整 */
        }



        #user-card {
            position: relative;
            /* 改为相对定位，在滚动流中 */
            margin: -21px auto 0 auto;
            /* 顶部外边距20px, 左右自动居中 */
            width: 90%;
            max-width: 390px;
            /* 减小最大宽度 */
            height: 250px;
            /* 减小总高度 */
            border-radius: 25px;
            /* 稍微减小圆角 */
            overflow: hidden;
            background-color: #ffffff;
            /* 白色背景 */
            flex-shrink: 0;
            /* 防止被flex布局压缩 */
        }

        /* 【全新】卡片背景层样式 (让其可见并可点击) */
        #user-card-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            /* 【核心修正】让背景层铺满整个卡片 */
            height: 100%;
            z-index: 1;
            /* 确保它在最底层 */
            cursor: pointer;
            /* 鼠标悬浮时显示小手图标 */
            /* 【核心新增】让JS设置的背景图能正确显示 */
            background-size: cover;
            background-position: center;
        }

        /* 【全新】卡片前景层裁剪容器 */
        #user-card-foreground-clipper {
            position: absolute;
            /* 【核心恢复】恢复你最初的定位方式，这是形成弧形的关键 */
            bottom: -110px;
            left: 0;
            width: 100%;
            height: 250px;
            /* 【核心新增】确保它在背景层之上 */
            z-index: 2;
        }

        /* 【全新】卡片前景层内容实体 */
        #user-card-foreground-content {
            width: 100%;
            height: 100%;
            background-color: #ffffff;
            /* 白色背景 */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.441);
            border-radius: 25px;
            /* 【核心】自身的圆角，被裁剪后形成弧形 */
            box-sizing: border-box;
        }

        /* 用户文字信息容器 */
        #user-info-text {
            position: absolute;
            /* 定位在前景层之上 */
            bottom: 120px;
            /* 【修改】相对于 clipper 定位，值需要重新计算 */
            left: 0;
            width: 100%;
            text-align: center;
            /* 文字居中 */
            z-index: 3;
            /* 确保文字在最上层 */
            padding: 0 20px;
            /* 左右留些边距 */
            box-sizing: border-box;
        }

        /* 卡片头像 */
        #user-card-avatar {
            position: absolute;
            /* 绝对定位，脱离文档流，才能悬浮 */
            top: 58px;
            /* 头像的垂直中心线位置 */
            left: 50%;
            /* 水平居中 */
            transform: translateX(-50%);
            /* 水平居中修正 */
            width: 80px;
            /* 头像宽度 */
            height: 80px;
            /* 头像高度 */
            border-radius: 50%;
            /* 完美圆形 */
            border: 3px solid white;
            /* 白色描边 */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            /* 阴影 */
            cursor: pointer;
            z-index: 5;
            /* 【层级提升】确保头像在所有前景元素之上 */
            background-color: white;
            /* 【新增】白色背景 */
            display: flex;
            /* 【新增】Flex布局 */
            justify-content: center;
            /* 【新增】水平居中SVG */
            align-items: center;
            /* 【新增】垂直居中SVG */
        }

        /* 文字基本样式重置 */
        #user-info-text p {
            margin: 6px 0;
            /* 减小段落间距 */
        }

        /* ID样式 */
        #user-id {
            font-size: 14px;
            font-weight: 600;
            /* 稍粗体 */
            color: #333;
        }

        /* @handle样式 */
        #user-handle {
            font-size: 12px;
            color: #aaa;
            /* 浅灰色 */
        }

        /* 个人简介样式 (带长度限制) */
        #user-bio {
            font-size: 12px;
            color: #555;
            /* 浅黑色 */
            white-space: nowrap;
            /* 强制不换行 */
            overflow: hidden;
            /* 隐藏溢出部分 */
            text-overflow: ellipsis;
            /* 溢出部分显示省略号 */
            max-width: 100%;
            /* 确保在父容器内 */
            margin-top: 6px;
        }

        /* 地址样式 */
        #user-location {
            display: inline-flex;
            /* 使用flex布局让图标和文字对齐 */
            align-items: center;
            gap: 4px;
            /* 图标和文字的间距 */
            font-size: 10.5px;
            color: #4e4e4e;
            font-weight: 560;
            /* 稍粗体 */
            margin-top: 2px;
        }

        /* --- 【位置调整后】中间App图标容器 --- */
        #main-apps-container {
            position: absolute;
            top: 340px;
            right: 26.8px;
            width: 160px;
            /* 【修复】稍微增加容器宽度以容纳更大的间距 */

            /* --- 【核心修复】从 Flexbox 改为 Grid 布局 --- */
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            /* 定义为两列，每列占据可用空间的一半 */

            /* 【核心修复】独立控制行间距和列间距 */
            row-gap: 15px;
            /* 保持原来的垂直间距 */
            column-gap: 12px;
            /* 【修复】显著增大列之间的水平间距 */
        }


        /* --- 【位置调整后】音乐组件 --- */
        #music-widget {
            position: absolute;
            top: 510px;
            /* 定位到自定义矩形条下方 */
            right: 30px;
            /* 距离右边框的距离 */
            width: 158px;
            /* 稍微放大一点以匹配草图 */
            height: 158px;
        }

        #record-outer {
            width: 100%;
            /* 使用百分比以适应父容器 */
            height: 100%;
            background-color: #222;
            /* 黑色外圈 */
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #record-inner {
            width: 108px;
            /* 白色内圈大小 */
            height: 108px;
            background-color: #fff;
            border-radius: 50%;
            cursor: pointer;
        }

        /* --- 底部Dock栏 --- */
        #bottom-dock {
            position: absolute;
            /* 恢复为 absolute 定位 */
            bottom: 30px;
            /* 【核心修改】设置一个正值，让它在布局的底部，而不是屏幕外 */
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 340px;
            height: 75px;
            z-index: 100;
            /* 保留 z-index */

            /* --- 【V1.92 最终美化版】多层次样式叠加 --- */
            /* 1. 通透层(光泽) + 底层(基色) - 微调透明度以增强对比 */
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.35), rgba(255, 255, 255, 0.15)),
                rgba(255, 255, 255, 0.25);

            /* 2. 模糊层 (保持不变) */
            backdrop-filter: blur(17px);
            -webkit-backdrop-filter: blur(15px);

            /* 3. 【核心修复】移除呆板的 border 属性 */
            /* border: 1.5px solid rgba(255, 255, 255, 0.25); */

            box-shadow:
                /* 顶部和左侧的亮边高光 (更亮更细) */
                inset 0.8px 0.8px 1px rgba(255, 255, 255, 0.7),
                /* 底部和右侧的暗边轮廓 (更暗更细) */
                inset -0.8px -0.8px 1px rgba(255, 255, 255, 0.15),
                /* 外部的悬浮投影 */
                0 2px 8px rgba(0, 0, 0, 0.1);

            border-radius: 32px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 10px;
            box-sizing: border-box;
        }

        /* 【【【核心新增】】】为Dock栏内的App图标设置专属样式，解决“双重玻璃”问题 */
        #bottom-dock .new-app-icon {
            background-color: rgba(255, 255, 255, 0.09);
            /* 3. 【强化质感】用更强的内外阴影和边框来模拟玻璃实体感 */
            box-shadow: inset 0 0.125em 0.125em rgba(0, 0, 0, 0.05),
                inset 0 0.125em 0.125em rgba(255, 255, 255, 0.2),
                0 0.25em 0.125em -0.125em rgba(0, 0, 0, 0.2);
        }

        /* --- 全局新App图标样式 --- */
        .new-app-icon {
            width: 58px;
            height: 58px;

            /* --- 【V1.92 最终美化版】多层次样式叠加 --- */
            /* 1. 通透层(光泽) + 底层(基色) - 微调透明度以增强对比 */
            background: linear-gradient(135deg, rgba(198, 198, 198, 0.1), rgba(224, 224, 224, 0.299)),
                rgba(246, 246, 246, 0.183);

            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(17px);
            box-shadow: inset 0 0.125em 0.125em rgba(0, 0, 0, 0.05),
                inset 0 -0.125em 0.125em rgba(255, 255, 255, 0.2),
                0 0.25em 0.125em -0.125em rgba(0, 0, 0, 0.2);
            transition: all 400ms cubic-bezier(0.25, 1, 0.5, 1);
            border-radius: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .new-app-icon:active {
            transform: scale(0.92);
            /* 点击时缩小 */
        }

        /* 【新增】中间App图标的独立大小 */
        #main-apps-container .new-app-icon {
            width: 69.5px;
            height: 67.5px;
        }

        /* 【新增】底部Dock栏图标的独立大小 */
        #bottom-dock .new-app-icon {
            width: 52px;
            height: 52px;
        }

        /* 
        ===================================================================
         【全新】V1.48 新增桌面组件样式
        ===================================================================
        */

        /* --- 纪念日组件 --- */
        #days-matter-widget {
            position: absolute;
            top: 430px;
            /* 【位置微调】与右侧图标顶部对齐 */
            left: 25px;
            width: 158px;
            height: 158px;
            /* --- 【核心修复】多层次样式叠加 --- */
            /* 1. 通透层(光泽) + 底层(基色) */
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0.22)),
                rgba(255, 255, 255, 0.12);

            /* 2. 模糊层 (增加模糊度) */
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            border-radius: 22px;
            /* 【核心】使用box-shadow模拟不规则描边 */
            box-shadow:
                -0.8px -0.8px 0.5px rgba(245, 245, 245, 0.313) inset,
                /* 左上角亮的内阴影 (模拟粗边) */
                1.4px 1.4px 1px rgba(255, 255, 255, 0.557) inset;
            /* 右下角暗的内阴影 (模拟细边) */
            display: flex;
            flex-direction: column;
            overflow: hidden;
            /* 必须保留，用于裁剪圆角 */
        }

        /* 【全新】上半部分样式 */
        .widget-top-pane {
            height: 39px;
            /* 顶部区域高度 */
            flex-shrink: 0;
            /* 【核心】设置一个更深、更不透明的背景 */
            background-color: rgba(206, 206, 206, 0.105);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 10px;
            box-sizing: border-box;
        }

        .days-matter-title {
            font-size: 14px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
            /* 文字改为白色以适应深色背景 */
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        /* 【全新】下半部分样式 */
        .widget-bottom-pane {
            flex-grow: 1;
            /* 【核心】设置一个更浅、更透明的背景 */
            background-color: rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding-bottom: 5px;
        }

        .days-matter-content {
            font-size: 48px;
            font-weight: 500;
            line-height: 1.1;
        }

        /* 当有数字时，文字为白色 */
        .days-matter-content:not(:empty) {
            color: white;
            font-weight: 600;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        /* “暂无纪念日”的特殊样式 */
        span.days-matter-content {
            font-size: 14px;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.7);
            /* 改为白色系 */
        }

        .days-matter-date {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 8px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        /* --- 自定义矩形条容器 --- */
        #capsule-widgets-container {
            position: absolute;
            top: 350px;
            /* 定位在纪念日组件下方 */
            left: 30px;
            width: 150px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            /* 两个矩形条之间的间距 */
        }

        /* 单个矩形条样式 */
        .capsule-widget {
            width: 100%;
            height: 50px;
            /* 高度 */
            background-color: rgba(255, 255, 255, 0.162);
            /* 浅黑色半透明 */
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 28px;
            /* 圆角 */
            border: 0.6px solid rgba(255, 255, 255, 0.548);
            /* 浅灰色描边 */
            display: flex;
            align-items: center;
            padding: 0 10px;
            /* 内部左右边距 */
            box-sizing: border-box;
            gap: 8px;
            /* 图标和文字的间距 */
        }

        .capsule-icon {
            width: 34px;
            /* 圆形图标大小 */
            height: 34px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.2);
            /* 默认背景 */
            flex-shrink: 0;
            cursor: pointer;
            background-size: cover;
            background-position: center;
        }

        .capsule-text {
            flex-grow: 1;
            /* 占据所有剩余空间 */
            margin: 0;
            font-size: 9px;
            font-style: italic;
            /* 斜体 */
            color: white;
            /* 白色文字 */
            /* 【核心】使用text-shadow实现发光效果 */
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.7), 0 0 10px rgba(255, 255, 255, 0.5);
            /* 【核心】文字长度限制 */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
            /* 【核心修复】确保即使没内容也能被点击 */
            min-height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            /* 让文字在编辑时也居中 */
        }

        /* --- 电脑端：画中画容器样式 --- */
        #phone-wrapper {
            /* 这里定义了手机的长方体尺寸，你可以自己微调 */
            width: 390px;
            height: 844px;

            /* 容器外观 */
            background-color: #fff;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.15);
            /* 悬浮阴影 */
            border-radius: 40px;
            /* 屏幕圆角 */
            overflow: hidden;
            /* 切除圆角外的内容 */

            position: relative;
            flex-shrink: 0;
            /* 防止被浏览器挤压变形 */
        }

        /* --- 手机端：自动全屏适配 --- */
        /* 当屏幕宽度小于 500px 时（即在手机上打开），强制占满全屏 */
        @media (max-width: 500px) {
            body {
                background-color: #fafafa;
                /* 恢复手机背景色 */
                display: block;
                /* 取消居中布局 */
            }

            #phone-wrapper {
                width: 100%;
                height: 100%;
                border-radius: 0;
                /* 去掉圆角 */
                box-shadow: none;
                /* 去掉阴影 */
                margin: 0;
            }
        }

        /* 【全新 V1.79 修正】当在手机框模式下，应用微缩放并调整布局间距 */
        body.phone-frame-visible #couple-space-screen .couple-space-content {
            transform: scale(1.1);
            /* 轻微放大以保证清晰度，您可以微调此值 */
            padding-top: 40px;
            /* 减小顶部内边距 */
            gap: -15px;
            /* 减小主要元素间的通用间距 */
        }

        body.phone-frame-visible #polaroid-container {
            margin-bottom: 5px;
            /* 大幅减小拍立得和头像间的间距 */
        }

        body.phone-frame-visible #couple-space-screen .couple-avatars-container {
            margin-top: 55px;
            /* 大幅减小头像和上方元素的间距 */
        }

        body.phone-frame-visible #couple-space-screen .couple-space-prompt {
            margin-top: 30px;
            /* 减小提示语和头像的间距 */
        }

        body.phone-frame-visible .couple-bottom-nav {
            bottom: 60px;
            /* 向上移动底部导航栏，使其更紧凑 */
        }


        /* 
        ===================================================================
         【全新 V1.57.3】为手机框模式下的Dock栏设置专属位置
        ===================================================================
        */
        body.phone-frame-visible #bottom-dock {
            /*
            ===========================================================
             【核心】Dock栏底部距离调整区 (仅在手机框模式下生效)
            ===========================================================
            说明：
            - 我们将 `bottom` 的值从原来的 `-100px` 覆盖为一个正数。
            - 正数 `30px` 代表Dock栏的底部距离其容器(#home-screen)的底部有30像素的间距。
            - 您可以把 30px 这个值改大（比如 40px）或改小（比如 20px），
              来精确控制Dock栏在手机框内的垂直位置，直到您满意为止。
            */
            bottom: 30px;
        }
    </style>
</head>

<body>
    <div id="phone-wrapper">
        <div id="phone-screen">
            <!-- 【新增】手机顶部状态栏 -->
            <div id="status-bar">
                <div id="status-bar-time">00:00</div>
                <div id="status-bar-icons">
                    <!-- 【核心修改】为这个天气图标添加一个唯一的ID -->
                    <svg id="status-bar-weather-icon" t="1757565492604" class="icon" viewBox="0 0 1239 1024"
                        version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="106700" width="22" height="22">
                        <path
                            d="M717.865062 899.486106l-39.910605-23.536026 36.84055-25.582694c13.303501-8.18647 18.420326-28.652544 7.163494-45.025485-9.210163-12.279706-28.653773-15.349555-41.957274-6.139802l-24.560333 17.396224 0-31.722492c0-15.349555-14.326886-30.699213-31.723827-30.699213s-31.723827 15.349555-31.723827 30.699213l0 36.839023-27.630387-19.44279c-16.373555-9.209754-33.770496-4.093235-42.980659 9.209754-10.233446 15.349555-6.140109 34.792448 9.210163 44.002202l34.793882 21.489459-41.957274 27.629261c-13.303501 9.209754-18.420326 27.629261-8.186778 41.955533 6.140109 9.209754 16.373555 13.302989 25.583718 13.302989 6.140109 0 11.256832-1.023283 17.396941-5.116518l33.770496-22.512742 0 36.839023c0 16.372941 14.326886 30.699213 31.723827 30.699213s31.723827-14.326272 31.723827-30.699213l0-35.815717 28.653773 19.44279c6.140109 3.069952 12.280218 4.093235 16.373555 4.093235 10.233446 0 19.44361-4.093235 25.583718-14.326272C736.285389 927.115366 733.215334 909.719245 717.865062 899.486106L717.865062 899.486106zM962.445517 867.76361l-24.560333-17.396224 23.53705-13.302989c11.256832-9.209754 13.303501-25.582694 5.116723-36.839014-6.140109-11.25632-23.53705-15.349555-34.793882-7.163187l-13.303501 8.18647 0-16.372899c0-13.302989-12.280218-24.559309-26.607104-24.559309-13.303501 0-24.560333 11.25632-24.560333 24.559309l0 19.442818-16.373555-10.233037c-11.256832-5.116518-27.630387-3.069952-36.84055 8.18647-6.140109 12.279706-3.070054 28.652544 9.210163 36.839014l20.466995 12.279706-24.560333 18.419507c-12.280218 8.18647-16.373555 23.536026-8.186778 35.815731 4.09344 7.163187 13.303501 10.233037 22.513664 10.233037 4.09344 0 9.210163-1.023283 12.280218-3.069952l21.490381-14.326272 0 22.512736c0 12.279706 11.256832 24.559309 24.560333 24.559309 14.326886 0 26.607104-12.279706 26.607104-24.559309l0-21.48943 15.350272 12.279706c5.116723 2.046566 9.210163 3.069952 14.326886 3.069952 8.186778 0 17.396941-3.069952 21.490381-11.25632C976.772403 890.276352 973.702349 875.95008 962.445517 867.76361L962.445517 867.76361zM413.930394 867.76361l-24.560333-17.396224 22.513664-13.302989c12.280218-9.209754 15.350272-25.582694 6.140109-36.839014-7.163494-11.25632-23.53705-15.349555-35.817267-7.163187l-13.303501 8.18647 0-16.372899c0-13.302989-11.256832-24.559309-24.560333-24.559309-15.350272 0-27.630387 11.25632-27.630387 24.559309l0 19.442818-14.326886-10.233037c-12.280218-5.116518-28.653773-3.069952-35.817267 8.18647-8.186778 12.279706-4.09344 28.652544 7.163494 36.839014l21.490381 12.279706-25.583718 18.419507c-11.256832 8.18647-15.350272 23.536026-7.163494 35.815731 5.116723 7.163187 12.280218 10.233037 20.466995 10.233037 5.116723 0 11.256832-1.023283 14.326886-3.069952l19.44361-14.326272 0 22.512736c0 12.279706 12.280218 24.559309 27.630387 24.559309 13.303501 0 24.560333-12.279706 24.560333-24.559309l0-21.48943 16.373555 12.279706c5.116723 2.046566 9.210163 3.069952 14.326886 3.069952 8.186778 0 16.373555-3.069952 21.490381-11.25632C429.280666 890.276352 426.210611 875.95008 413.930394 867.76361L413.930394 867.76361zM984.959181 210.80105c-11.256832 0-22.513664 1.023283-35.817267 3.069952-38.887219-119.726797-169.875968-213.871002-313.144832-213.871002l-2.046698 0c-218.996736 1.023283-319.284941 141.216256-353.055437 254.803251-11.256832-1.023283-22.513664-2.046566-34.793882-2.046566-86.984704 0-165.782528 42.978816-212.856627 117.68023l-1.023386 1.023283c-33.770496 63.444992-68.564378 205.684531 54.237491 298.805453 38.887219 29.67593 94.148096 31.722496 115.638477 31.722496l1.023349 0 814.585923 0 10.233491 0c72.657818-13.302989 209.786573-85.957734 209.786573-249.686733C1237.726413 319.271526 1125.158093 210.80105 984.959181 210.80105L984.959181 210.80105zM1010.543002 588.40105l-807.422479 0c0 0 0 0-1.023386 0-20.466995 0-41.957274-5.116518-48.097382-9.209754-30.700442-22.512742-42.980659-52.18857-39.910605-92.097536 2.046669-30.699213 16.373555-55.258522 17.396941-59.351757 34.793882-57.30519 93.124813-63.444992 114.615091-63.444992 22.513664 0 36.84055 6.139802 41.957274 10.233037 16.373555 12.279706 37.863936 14.326272 58.330931 8.18647 16.373555-8.18647 30.700442-27.629261 32.747213-46.048768 2.046669-24.559309 28.653773-223.080755 254.813901-224.104038l2.046698 0c117.685146 0 209.786573 93.120819 213.880013 170.892186 0 19.44279 8.186778 34.792448 23.53705 45.025485 14.326886 11.25632 32.747213 12.279706 50.144154 8.18647 20.466995-8.18647 41.957274-12.279706 61.400986-12.279706 86.984704 0 140.19881 67.538227 140.19881 127.913267C1125.158093 553.608704 1033.056666 583.284531 1010.543002 588.40105z"
                            p-id="106701" fill="#353333"></path>
                    </svg>
                    <svg id="status-bar-battery-icon" t="1757369903873" class="icon" viewBox="0 0 1024 1024"
                        version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="33293" width="22" height="22">
                        <path
                            d="M984.2 434.8c-5-2.9-8.2-8.2-8.2-13.9v-99.3c0-53.6-43.9-97.5-97.5-97.5h-781C43.9 224 0 267.9 0 321.5v380.9C0 756.1 43.9 800 97.5 800h780.9c53.6 0 97.5-43.9 97.5-97.5v-99.3c0-5.8 3.2-11 8.2-13.9 23.8-13.9 39.8-39.7 39.8-69.2v-16c0.1-29.6-15.9-55.5-39.7-69.3zM912 702.5c0 12-6.2 19.9-9.9 23.6-3.7 3.7-11.7 9.9-23.6 9.9h-781c-11.9 0-19.9-6.2-23.6-9.9-3.7-3.7-9.9-11.7-9.9-23.6v-381c0-11.9 6.2-19.9 9.9-23.6 3.7-3.7 11.7-9.9 23.6-9.9h780.9c11.9 0 19.9 6.2 23.6 9.9 3.7 3.7 9.9 11.7 9.9 23.6v381z"
                            p-id="33294" fill="#515151"></path>
                        <path
                            d="M736 344v336c0 8.8-7.2 16-16 16H112c-8.8 0-16-7.2-16-16V344c0-8.8 7.2-16 16-16h608c8.8 0 16 7.2 16 16z"
                            p-id="33295" fill="#353333"></path>
                    </svg>
                </div>
            </div>

            <div id="home-screen" class="screen active">
                <!-- 【新增】顶部灵动岛 -->
                <div id="dynamic-island">
                    <div class="island-content"></div>
                </div>

                <!-- 【新增】用户信息卡片 -->
                <div id="user-card">
                    <!-- 背景层 -->
                    <div id="user-card-background" class="clickable-area"></div>

                    <!-- 【全新】前景层裁剪容器 (实现弧形的关键) -->
                    <div id="user-card-foreground-clipper">
                        <div id="user-card-foreground-content">
                            <!-- 文字信息 -->
                            <div id="user-info-text">
                                <p id="user-id">Name</p>
                                <p id="user-handle">@...</p>
                                <p id="user-bio">自定义文案</p>
                                <div id="user-location">
                                    <svg t="1757547877892" class="icon" viewBox="0 0 1024 1024" version="1.1"
                                        xmlns="http://www.w3.org/2000/svg" p-id="89228" width="15" height="15">
                                        <path
                                            d="M839.8 281.4c-17.9-42.3-43.5-80.3-76.1-112.9-32.6-32.6-70.6-58.2-112.9-76.1-43.8-18.6-90.4-28-138.3-28-48 0-94.5 9.4-138.3 27.9-42.3 17.9-80.3 43.5-112.9 76.1-32.6 32.6-58.2 70.6-76.1 112.9-18.5 43.8-27.9 90.3-27.9 138.3 0 81.3 57.4 196.2 170.5 341.5C410.3 867.3 494.1 952 495 952.8c4.6 4.7 11 7.3 17.5 7.3 6.6 0 12.9-2.6 17.5-7.3 0.8-0.8 84.6-85.6 167.2-191.6C810.4 616 867.8 501.1 867.8 419.7c0-47.9-9.4-94.5-28-138.3zM510.7 555.9c-71.9 0-130.4-58.5-130.4-130.4s58.5-130.4 130.4-130.4 130.4 58.5 130.4 130.4-58.5 130.4-130.4 130.4z"
                                            p-id="89229" fill="#515151"></path>
                                    </svg>
                                    <span>...</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 【修改】头像 (img -> div) -->
                    <div id="user-card-avatar" class="clickable-area">
                        <svg t="1757570711263" class="icon" viewBox="0 0 1024 1024" version="1.1"
                            xmlns="http://www.w3.org/2000/svg" p-id="118953" width="35" height="35">
                            <path
                                d="M959.791 258.732c-25.828-25.828-56.262-37.478-91.391-37.478H755.786l-25.828-68.002c-7.044-16.436-18.784-30.524-35.13-42.173-16.436-11.74-35.13-18.784-51.566-18.784H385.343c-18.784 0-35.13 7.044-51.565 18.784-16.436 11.74-28.176 25.828-35.13 42.173l-28.176 68.002H155.6c-35.13 0-65.653 11.74-91.391 37.478C38.38 284.56 26.73 314.994 26.73 350.214v452.532c0 35.13 11.74 65.654 37.478 91.482 25.828 25.828 56.262 37.477 91.391 37.477h712.71c35.13 0 65.653-11.74 91.39-37.477 25.829-25.828 37.479-56.262 37.479-91.482V350.214c0.09-35.22-11.56-65.654-37.388-91.482zM511.955 781.614c-117.22 0-213.397-96.088-213.397-213.397 0-117.22 96.087-213.398 213.397-213.398s213.397 96.088 213.397 213.398-96.178 213.397-213.397 213.397z m0 0"
                                p-id="118954" fill="#353333"></path>
                            <path
                                d="M511.955 427.607c-79.742 0-143.048 63.306-143.048 143.048s63.306 143.047 143.048 143.047 143.047-63.305 143.047-143.047-63.305-143.048-143.047-143.048z m0 0"
                                p-id="118955" fill="#353333"></path>
                        </svg>
                    </div>
                </div>

                <!-- 【全新】纪念日组件 -->
                <div id="days-matter-widget">
                    <!-- 上半部分深色区域 -->
                    <div class="widget-top-pane">
                        <span class="days-matter-title" style="display: none;">XXXX 已经</span>
                    </div>
                    <!-- 下半部分浅色区域 -->
                    <div class="widget-bottom-pane">
                        <span class="days-matter-content">暂无纪念日</span>
                        <span class="days-matter-date" style="display: none;">起始日: XXXX-XX-XX</span>
                    </div>
                </div>

                <!-- 【新增】中间区域的App图标 -->
                <div id="main-apps-container">
                    <!-- 序号①: 聊天 (保留功能) -->
                    <div class="new-app-icon app-icon" data-target="chat-list-screen">
                        <svg t="1757553299427" class="icon" viewBox="0 0 1024 1024" version="1.1"
                            xmlns="http://www.w3.org/2000/svg" p-id="94520" width="33.6" height="33.6">
                            <path
                                d="M678.115556 361.81333300000006c11.377778 0 22.755556 0 34.133333 2.275556C682.666667 227.55555600000002 534.755556 125.15555599999999 366.364444 125.15555599999999c-188.871111 0-341.333333 127.43111099999999-341.333333 291.271111 0 93.297778 52.337778 170.666667 136.533333 229.831111l-34.133333 102.4 120.60444500000001-59.164445c43.235556 9.102222 77.368889 18.204444 120.604444 18.204445 11.377778 0 20.48 0 31.857778-2.275556-6.826667-22.755556-11.377778-47.786667-11.377778-72.817778 0-147.911111 127.43111099999999-270.791111 288.99555599999997-270.791111z m-182.044445-91.022222c25.031111 0 43.235556 15.928889 43.235556 43.235556 0 25.031111-15.928889 43.235556-43.235556 43.235555-25.031111 0-52.337778-18.204444-52.337778-43.235555 0-27.306666999999997 25.031111-43.235556 52.337778-43.235556z m-241.208889 84.195556c-25.031111 0-52.337778-18.204444-52.337778-43.235556 0-25.031111 25.031111-43.235556 52.337778-43.235555 25.031111 0 43.235556 15.928889 43.235556 43.235555s-15.928889 43.235556-43.235556 43.235556z m0 0"
                                fill="#ffffff" p-id="94521"></path>
                            <path
                                d="M992.1422220000001 630.328889c0-136.533333-136.533333-248.03555600000004-291.271111-248.03555600000004-163.84 0-291.271111 111.502222-291.271111 248.03555600000004s127.43111099999999 248.03555600000004 291.271111 248.035555c34.133333 0 68.266667-9.102222 102.4-18.204444l93.297778 52.337778-25.031111-86.471111c68.266667-50.062222 120.604444-120.604444 120.604444-195.697778z m-386.844444-43.235556c-15.928889 0-34.133333-15.928889-34.133334-34.133333 0-15.928889 18.204444-34.133333 34.133334-34.133333 25.031111 0 43.235556 18.204444 43.235555 34.133333s-15.928889 34.133333-43.235555 34.133333z m188.871111 0c-15.928889 0-34.133333-15.928889-34.133333-34.133333 0-15.928889 18.204444-34.133333 34.133333-34.133333 25.031111 0 43.235556 18.204444 43.235555 34.133333s-18.204444 34.133333-43.235555 34.133333z m0 0"
                                fill="#ffffff" p-id="94522"></path>
                        </svg>
                    </div>
                    <!-- 论坛 -->
                    <div class="new-app-icon">
                        <svg t="1757553378424" class="icon" viewBox="0 0 1024 1024" version="1.1"
                            xmlns="http://www.w3.org/2000/svg" p-id="100419" width="32" height="32">
                            <path
                                d="M278.1184 735.0272h1.4336A1031.3728 1031.3728 0 0 0 573.44 582.2464a1242.3168 1242.3168 0 0 0 130.2528-106.7008c17.408-16.384 32.768-31.9488 46.2848-46.6944 16.7936-18.2272 30.72-34.816 41.984-49.152 5.7344-7.3728 10.8544-14.1312 15.1552-20.48l8.6016-12.288c2.8672-4.3008 5.5296-8.3968 8.192-12.6976A346.29632 346.29632 0 1 0 262.144 739.328l14.336-3.8912zM860.16 512q-10.4448 11.6736-21.7088 23.3472l-5.12 5.3248-20.48 20.48-7.7824 7.5776-20.48 19.2512-11.0592 10.0352-19.0464 16.7936-14.7456 12.4928-16.9984 14.1312-20.48 15.7696-13.5168 10.6496q-17.2032 13.1072-34.816 25.8048t-35.6352 24.7808l-14.336 9.4208-20.48 13.7216-18.6368 11.4688-16.1792 9.8304-21.504 12.4928-12.9024 7.168-23.7568 12.6976-10.0352 5.12-25.8048 12.9024-6.9632 3.2768-27.8528 12.6976-4.096 1.8432c-10.0352 4.3008-20.48 8.3968-29.9008 12.288a346.112 346.112 0 0 0 503.808-308.4288 337.5104 337.5104 0 0 0-4.096-51.8144c-6.9632 8.3968-14.336 16.7936-21.9136 25.1904z"
                                fill="#ffffff" p-id="100420"></path>
                            <path
                                d="M942.08 189.0304c-16.1792-22.528-48.3328-46.8992-112.64-46.8992a305.9712 305.9712 0 0 0-39.3216 2.6624 34.05824 34.05824 0 0 0 4.096 67.9936h4.7104a242.0736 242.0736 0 0 1 30.9248-2.2528c28.2624 0 48.3328 6.3488 56.9344 18.432 12.9024 18.0224 5.12 55.5008-22.1184 104.0384-3.072 5.5296-6.5536 11.264-10.24 17.2032s-6.7584 10.8544-10.6496 16.5888A1033.216 1033.216 0 0 1 593.92 610.304a1066.1888 1066.1888 0 0 1-304.7424 157.696h-3.072l-18.8416 4.9152-20.48 4.3008a276.8896 276.8896 0 0 1-52.6336 5.7344c-31.744 0-50.3808-7.9872-57.5488-18.2272-13.7216-18.0224-3.6864-58.9824 24.9856-109.3632A34.01728 34.01728 0 1 0 102.4 621.7728c-56.32 97.0752-42.3936 153.3952-20.48 184.32 17.2032 23.9616 49.7664 47.104 112.4352 47.104a409.6 409.6 0 0 0 111.2064-18.2272h2.8672l17.2032-5.5296c6.7584-2.2528 13.5168-4.096 20.48-6.5536a1200.7424 1200.7424 0 0 0 286.72-155.4432 1204.224 1204.224 0 0 0 241.664-225.28l12.9024-16.9984q6.3488-8.8064 12.288-17.408c57.5488-86.2208 80.6912-165.2736 42.3936-218.7264z"
                                fill="#ffffff" p-id="100421"></path>
                            <path
                                d="M276.6848 735.4368h1.4336-1.4336l-14.336 3.8912zM417.9968 829.6448l27.8528-12.6976zM384.2048 843.776c9.8304-3.8912 20.48-7.9872 29.9008-12.288-10.0352 4.096-20.0704 8.192-29.9008 12.288zM752.8448 614.4l19.0464-16.7936zM563.2 753.2544l18.6368-11.4688zM602.9312 728.064l14.336-9.4208zM720.896 641.8432l16.9984-14.1312zM782.7456 588.3904l20.48-19.2512zM525.5168 775.5776l21.504-12.4928zM832.3072 540.2624l-20.48 20.48zM488.8576 795.4432l23.1424-12.6976zM453.0176 813.4656l25.8048-12.9024zM687.7184 668.2624l13.5168-10.6496z"
                                fill="#ffffff" p-id="100422"></path>
                        </svg>
                    </div>
                    <!-- 世界书 (保留功能) -->
                    <div class="new-app-icon app-icon" data-target="world-book-screen">
                        <svg t="1758207819060" class="icon" viewBox="0 0 1024 1024" version="1.1"
                            xmlns="http://www.w3.org/2000/svg" p-id="8038" width="39" height="39">
                            <path
                                d="M696.25 836.67H291.44c-55.51 0-100.67-45.16-100.67-100.67s45.16-100.67 100.67-100.67H664c11.05 0 20 8.95 20 20s-8.95 20-20 20H291.44c-33.46 0-60.67 27.22-60.67 60.67s27.22 60.67 60.67 60.67h404.81c24.31 0 44.09-19.78 44.09-44.09v-481c0-11.05 8.95-20 20-20s20 8.95 20 20v481.01c0 46.37-37.72 84.09-84.09 84.09z"
                                fill="#ffffff" p-id="8039"></path>
                            <path
                                d="M684 658H255.78L191 729V262.19c0-44.29 35.9-80.19 80.19-80.19H653.5c16.85 0 30.5 13.66 30.5 30.5V658zM680 756H292c-11.05 0-20-8.95-20-20s8.95-20 20-20h388c11.05 0 20 8.95 20 20s-8.95 20-20 20z"
                                fill="#ffffff" p-id="8040"></path>
                        </svg>
                    </div>
                    <!-- 情侣空间 -->
                    <div class="new-app-icon">
                        <svg t="1758208324049" class="icon" viewBox="0 0 1024 1024" version="1.1"
                            xmlns="http://www.w3.org/2000/svg" p-id="36005" width="33" height="33">
                            <path
                                d="M316.1 543.2H72.7c-5.1 0-8.5-3.4-8.5-8.5v-22.1c0-5.1 3.4-8.5 8.5-8.5H134c6.8 0 10.2-8.5 6.8-13.6-23.8-45.8-37.4-90-37.4-137.5 0-125.6 97-222.4 224.6-222.4 66.4 0 132.8 28.9 177 81.5 5.1 3.4 10.2 3.4 13.6 0 44.2-49.2 110.6-78.1 177-78.1 125.9 0 224.6 96.7 224.6 222.4 0 64.5-25.5 125.6-69.8 186.7-1.7 1.7-3.4 3.4-6.8 3.4H668.3c-3.4 0-5.1 1.7-6.8 3.4l-45.9 56c-5.1 6.8-13.6 3.4-15.3-3.4l-57.9-286.9c-1.7-10.2-13.6-10.2-17-1.7l-68.1 219c-3.4 8.5-13.6 8.5-17 0l-40.8-122.2c-1.7-8.5-11.9-8.5-15.3-1.7l-68.1 134.2z"
                                fill="#ffffff" p-id="36006"></path>
                            <path
                                d="M950.8 583.9c5.1 0 8.5 3.4 8.5 10.2v22.1c0 5.1-3.4 8.5-8.5 8.5H782.3c-3.4 0-5.1 1.7-6.8 3.4-56.1 57.7-125.9 120.5-207.6 191.8l-51.1 50.9c-1.5 1.6-3.7 2.6-6 2.6s-4.4-0.9-6-2.6l-51-50.9c-95.3-83.2-175.3-154.5-234.9-220.7-5.1-6.8 0-15.3 6.8-15.3h108.9c3.4 0 6.8-1.7 8.5-5.1l37.4-78.1c1.7-6.8 11.9-6.8 15.3 0L440 622.9c3.4 6.8 13.6 6.8 17 0l59.6-154.5c3.4-6.8 15.3-6.8 17 1.7L588 668.7c1.7 6.8 10.2 8.5 15.3 3.4l68.1-84.9c1.7-1.7 3.4-3.4 6.8-3.4h272.6z"
                                fill="#ffffff" p-id="36007"></path>
                        </svg>
                    </div>
                </div>

                <!-- 【全新】底部两个自定义矩形条 -->
                <div id="capsule-widgets-container">
                    <div class="capsule-widget">
                        <div class="capsule-icon clickable-area"></div>
                        <p class="capsule-text clickable-area"></p>
                    </div>

                </div>

                <!-- 【位置调整】黑胶唱片/音乐组件 -->
                <div id="music-widget">
                    <div id="record-outer">
                        <div id="record-inner" class="clickable-area"></div>
                    </div>
                </div>

                <!-- 【新增】底部Dock栏 -->
                <div id="bottom-dock">
                    <!--  设置 (保留功能) -->
                    <div class="new-app-icon app-icon" data-target="main-settings-screen">
                        <svg t="1757546076600" class="icon" viewBox="0 0 1024 1024" version="1.1"
                            xmlns="http://www.w3.org/2000/svg" p-id="63192" width="28" height="28">
                            <path
                                d="M424.680727 94.301091a426.216727 426.216727 0 0 1 174.545455-0.093091 170.356364 170.356364 0 0 0 83.409454 122.135273 170.356364 170.356364 0 0 0 147.549091 11.170909 426.077091 426.077091 0 0 1 87.133091 151.226182 170.356364 170.356364 0 0 0-64 133.213091 170.356364 170.356364 0 0 0 64.093091 133.306181 428.637091 428.637091 0 0 1-87.272727 151.133091 170.356364 170.356364 0 0 0-147.502546 11.170909 170.356364 170.356364 0 0 0-83.362909 122.042182 426.356364 426.356364 0 0 1-174.545454 0.139637 170.356364 170.356364 0 0 0-83.409455-122.181819 170.356364 170.356364 0 0 0-147.502545-11.170909 426.216727 426.216727 0 0 1-87.179637-151.179636 170.356364 170.356364 0 0 0 64-133.259636A170.356364 170.356364 0 0 0 106.589091 378.693818a428.497455 428.497455 0 0 1 87.272727-151.179636 170.356364 170.356364 0 0 0 147.456-11.170909 170.356364 170.356364 0 0 0 83.362909-122.042182zM512 640a128 128 0 1 0 0-256 128 128 0 0 0 0 256z"
                                fill="#ffffff" p-id="63193"></path>
                        </svg>
                    </div>
                    <!-- 相机 -->
                    <div class="new-app-icon">
                        <svg t="1757546170923" class="icon" viewBox="0 0 1024 1024" version="1.1"
                            xmlns="http://www.w3.org/2000/svg" p-id="65746" width="26.8" height="26.8">
                            <path
                                d="M 694.08 549.76 c 0 92.8 -75.52 168.32 -168.32 168.32 s -168.32 -75.52 -168.32 -168.32 c 0 -93.44 75.52 -168.64 168.32 -168.64 s 168.32 75.2 168.32 168.64 Z"
                                fill="#ffffff" p-id="65747"></path>
                            <path
                                d="M 917.76 239.36 h -119.36 L 646.4 152 c -16.64 -12.8 -27.84 -19.84 -48.96 -19.84 h -163.84 c -21.44 0 -42.24 7.04 -59.52 20.48 L 219.84 239.36 h -124.8 C 54.08 239.36 20.48 272.96 20.48 313.92 v 524.8 c 0 40.96 33.6 74.56 74.56 74.56 h 822.72 A 74.56 74.56 0 0 0 992 838.72 V 313.92 c 0 -40.96 -32.96 -74.56 -74.24 -74.56 Z M 525.76 781.44 c -130.88 0 -236.8 -106.24 -236.8 -236.8 s 106.24 -236.48 236.8 -236.48 c 130.88 0 236.8 106.24 236.8 236.48 c 0 130.56 -105.92 236.8 -236.8 236.8 Z"
                                fill="#ffffff" p-id="65748"></path>
                            <path
                                d="M 694.08 549.76 c 0 92.8 -75.52 168.32 -168.32 168.32 s -168.32 -75.52 -168.32 -168.32 c 0 -93.44 75.52 -168.64 168.32 -168.64 s 168.32 75.2 168.32 168.64 Z"
                                fill="#ffffff" p-id="65749"></path>
                            <path
                                d="M 694.08 549.76 c 0 92.8 -75.52 168.32 -168.32 168.32 s -168.32 -75.52 -168.32 -168.32 c 0 -93.44 75.52 -168.64 168.32 -168.64 s 168.32 75.2 168.32 168.64 Z"
                                fill="#ffffff" p-id="65750"></path>
                        </svg>
                    </div>
                    <!-- 短信 -->
                    <div class="new-app-icon">
                        <svg t="1757546242938" class="icon" viewBox="0 0 1024 1024" version="1.1"
                            xmlns="http://www.w3.org/2000/svg" p-id="66891" width="32" height="32">
                            <path
                                d="M853.333333 324.266667l-315.733333 243.2v4.266666-4.266666L213.333333 324.266667V554.666667H170.666667V256h725.333333v554.666667H170.666667v-42.666667h682.666666V324.266667z m-34.133333-25.6H247.466667l285.866666 217.6L819.2 298.666667zM85.333333 597.333333h170.666667v42.666667H85.333333v-42.666667z m-42.666666 85.333334h170.666666v42.666666H42.666667v-42.666666z"
                                fill="#ffffff" p-id="66892"></path>
                        </svg>
                    </div>
                    <!--电话 -->
                    <div class="new-app-icon">
                        <svg t="1757546341829" class="icon" viewBox="0 0 1024 1024" version="1.1"
                            xmlns="http://www.w3.org/2000/svg" p-id="68912" width="28" height="28">
                            <path
                                d="M751.616 972.8h-4.608c-110.592-5.632-260.096-109.568-399.872-278.528l-51.712-62.464C155.648 462.848 82.432 297.984 99.84 190.976 111.616 115.2 224.256 51.2 288.768 51.2c31.744 0 43.008 15.872 47.104 25.088 36.352 64.512 81.408 177.152 81.92 217.6v3.072l-1.024 2.56c-8.192 20.992-26.112 31.232-41.984 40.448-20.992 11.776-32.768 19.456-34.304 41.984-0.512 6.656 5.632 37.376 97.792 151.04l39.424 47.616c92.16 109.056 121.344 120.832 128.512 121.856 22.528 3.072 32.768-6.656 48.64-24.064 12.288-13.312 26.112-28.672 48.64-31.744l3.072-0.512 3.072 0.512c40.448 8.704 143.36 74.752 201.728 123.904 8.192 5.632 23.04 22.016 11.264 58.88-18.432 57.856-98.304 143.36-171.008 143.36z"
                                p-id="68913" fill="#ffffff"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- 【全新】隐藏的文件上传工具 -->
            <input type="file" id="sticker-file-input" accept="image/*" style="display: none;">
            <input type="file" id="desktop-file-input" accept="image/*" style="display: none;"> <!-- 【新增】桌面专用的文件上传工具 -->
            <input type="file" id="me-avatar-upload-input" accept="image/*" style="display: none;">
            <script>
                // ===================================================================
                // 【全新 V1.81 修复方案】IndexedDB 数据库帮助函数
                // ===================================================================
                const db = {
                    _db: null,
                    _dbName: 'KikiChatDB',
                    _storeName: 'kv_store',

                    async _getDB() {
                        if (this._db) return this._db;
                        return new Promise((resolve, reject) => {
                            const request = indexedDB.open(this._dbName, 1);
                            request.onerror = () => reject("Error opening db");
                            request.onsuccess = (event) => {
                                this._db = event.target.result;
                                resolve(this._db);
                            };
                            request.onupgradeneeded = (event) => {
                                const db = event.target.result;
                                if (!db.objectStoreNames.contains(this._storeName)) {
                                    db.createObjectStore(this._storeName);
                                }
                            };
                        });
                    },

                    async get(key) {
                        const db = await this._getDB();
                        return new Promise((resolve) => {
                            const transaction = db.transaction(this._storeName, 'readonly');
                            const store = transaction.objectStore(this._storeName);
                            const request = store.get(key);
                            request.onsuccess = () => resolve(request.result);
                            request.onerror = () => resolve(undefined);
                        });
                    },

                    async set(key, value) {
                        const db = await this._getDB();
                        return new Promise((resolve, reject) => {
                            const transaction = db.transaction(this._storeName, 'readwrite');
                            const store = transaction.objectStore(this._storeName);
                            const request = store.put(value, key);
                            request.onsuccess = () => resolve(true);
                            request.onerror = (e) => reject("Error setting value in db: " + e.target.error);
                        });
                    }
                };

                document.addEventListener('DOMContentLoaded', () => {
                    // 2. 这里放变量定义 (Variables)
                    // 【核心补全】状态变量与缓存地图
                    let currentImageUploadTarget = null; // 记录当前正在上传哪个位置的图片
                    let desktopSettings = {};            // 存储桌面的文字和图片数据
                    let desktopWallpaper = '';           // 存储壁纸数据
                    let desktopIconSettings = {};        // 存储图标设置
                    const iconConfigMap = {};            // 缓存图标元素的地图
                    const defaultIconSVGs = {};          // 备份默认图标的SVG
                    // --- 桌面组件 ---
                    const desktopFileInput = document.getElementById('desktop-file-input');
                    const userCardBackground = document.getElementById('user-card-background');
                    const userCardAvatar = document.getElementById('user-card-avatar');
                    const recordInner = document.getElementById('record-inner');
                    const capsuleIcon = document.querySelector('.capsule-widget .capsule-icon');
                    const userIdText = document.getElementById('user-id');
                    const userHandleText = document.getElementById('user-handle');
                    const userBioText = document.getElementById('user-bio');
                    const userLocationText = document.querySelector('#user-location span');
                    const capsuleText = document.querySelector('.capsule-widget .capsule-text');

                    // --- 情侣空间 ---
                    const coupleSpaceScreen = document.getElementById('couple-space-screen');
                    const coupleSpaceInviteScreen = document.getElementById('couple-space-invite-screen');
                    const myAvatarWrapper = document.querySelector('.my-avatar-wrapper');
                    const myAvatarImg = document.getElementById('couple-my-avatar-img');
                    const partnerAvatarWrapper = document.querySelector('.partner-avatar-wrapper');
                    const coupleAvatarUploadInput = document.getElementById('couple-avatar-upload-input');
                    const coupleInviteListContainer = document.getElementById('couple-invite-list-container');
                    const successToast = document.getElementById('success-toast');
                    const coupleSpaceOptionsBtn = document.getElementById('couple-space-options-btn');
                    const coupleThemeScreen = document.getElementById('couple-theme-screen');
                    const coupleThemeBackBtn = document.getElementById('couple-theme-back-btn');
                    const coupleThemeEditBtn = document.getElementById('couple-theme-edit-btn');
                    const coupleBottomNav = document.querySelector('.couple-bottom-nav');
                    const navSlider = document.querySelector('.nav-slider');
                    const navIconWrappers = document.querySelectorAll('.nav-icon-wrapper');
                    const coupleContentPages = document.querySelectorAll('.couple-content-page');
                    const themeBgUploadBtn = document.getElementById('theme-bg-upload-btn');
                    const themeResetBtn = document.getElementById('theme-reset-btn');
                    const polaroidItems = document.querySelectorAll('.polaroid-item');

                    // --- 邀请弹窗 ---
                    const inviteModal = document.getElementById('couple-invite-modal');
                    const inviteModalAiAvatar = document.getElementById('invite-modal-ai-avatar');
                    const inviteModalUserAvatar = document.getElementById('invite-modal-user-avatar');
                    const inviteAnimationContainer = document.querySelector('.invite-avatars-animation-container');
                    const inviteAcceptBtn = document.getElementById('invite-accept-btn');
                    const inviteRejectBtn = document.getElementById('invite-reject-btn');
                    const inviteModalCloseBtn = document.querySelector('.invite-modal-close-btn');

                    // --- 外观设置 ---
                    const appearanceSettingsBtn = document.querySelector('.settings-item[data-target="appearance-settings-screen"]'); // 需要后续添加
                    const gotoAppIconSettingsBtn = document.getElementById('goto-app-icon-settings-btn');
                    const openDesktopWallpaperModalBtn = document.getElementById('open-desktop-wallpaper-modal-btn');
                    const desktopWallpaperModal = document.getElementById('desktop-wallpaper-modal');
                    const desktopWallpaperPreview = document.getElementById('desktop-wallpaper-preview');
                    const removeDesktopWallpaperBtn = document.getElementById('remove-desktop-wallpaper-btn');
                    const desktopWallpaperUploadInput = document.getElementById('desktop-wallpaper-upload-input');
                    const saveDesktopWallpaperBtn = document.getElementById('save-desktop-wallpaper-btn');
                    const appIconSettingsContainer = document.getElementById('app-icon-settings-container');

                    // 3. 这里放功能函数 (Functions)
                    // ===================================================================
                    // 【V1.50 新增】桌面交互核心功能函数
                    // ===================================================================

                    /**
                     * 【V1.81 最终修复版】保存桌面设置到 IndexedDB
                     */
                    async function saveDesktopSettings() {
                        try {
                            // 保存通用的桌面文本和图片设置
                            await db.set('desktopSettings', desktopSettings);
                            // 单独保存桌面壁纸
                            await db.set('desktopWallpaper', desktopWallpaper);
                            // 单独保存应用图标设置
                            await db.set('desktopIconSettings', desktopIconSettings);
                        } catch (error) {
                            console.error("Failed to save desktop data to IndexedDB:", error);
                            alert("保存桌面数据失败，可能是存储空间问题。");
                        }
                    }

                    /**
                     * 【V1.81 最终修复版】从 IndexedDB 加载桌面设置并应用
                     */
                    async function loadDesktopSettings() {
                        // 加载通用设置
                        const savedSettings = await db.get('desktopSettings') || {};
                        desktopSettings = {
                            userBackground: savedSettings.userBackground || '',
                            userAvatar: savedSettings.userAvatar || '',
                            userId: savedSettings.userId || 'Name',
                            userHandle: savedSettings.userHandle || '...',
                            userBio: savedSettings.userBio || '自定义文案',
                            userLocation: savedSettings.userLocation || '...',
                            capsuleIcon1: savedSettings.capsuleIcon1 || '',
                            capsuleText1: savedSettings.capsuleText1 || '',
                            recordInner: savedSettings.recordInner || ''
                        };

                        // 单独加载桌面壁纸
                        desktopWallpaper = await db.get('desktopWallpaper') || '';
                        // 单独加载图标设置
                        desktopIconSettings = await db.get('desktopIconSettings') || {};
                    }

                    /**
                     * 将 desktopSettings 对象中的数据显示在界面上
                     */
                    function applyDesktopSettings() {
                        // 应用桌面壁纸
                        const homeScreen = document.getElementById('home-screen');
                        if (desktopWallpaper) {
                            homeScreen.style.backgroundImage = `url(${desktopWallpaper})`;
                            homeScreen.style.backgroundSize = 'cover';
                            homeScreen.style.backgroundPosition = 'center';
                        } else {
                            homeScreen.style.backgroundImage = 'none';
                            // 如果需要默认颜色，可以在这里设置
                            // homeScreen.style.backgroundColor = '#a8d8f0'; 
                        }

                        // 应用卡片背景图片
                        if (desktopSettings.userBackground) {
                            userCardBackground.style.backgroundImage = `url(${desktopSettings.userBackground})`;
                            userCardBackground.style.backgroundSize = 'cover';
                            userCardBackground.style.backgroundPosition = 'center';
                        } else {
                            userCardBackground.style.backgroundImage = 'none';
                        }

                        // 应用头像
                        if (desktopSettings.userAvatar) {
                            userCardAvatar.style.backgroundImage = `url(${desktopSettings.userAvatar})`;
                            userCardAvatar.style.backgroundSize = 'cover';
                            userCardAvatar.style.backgroundPosition = 'center';
                            userCardAvatar.innerHTML = ''; // 清空默认的SVG图标
                        }

                        // 应用黑胶唱片图片
                        if (desktopSettings.recordInner) {
                            recordInner.style.backgroundImage = `url(${desktopSettings.recordInner})`;
                            recordInner.style.backgroundSize = 'cover';
                            recordInner.style.backgroundPosition = 'center';
                        } else {
                            recordInner.style.backgroundImage = 'none';
                        }

                        // 应用矩形条图标
                        if (desktopSettings.capsuleIcon1) {
                            capsuleIcon.style.backgroundImage = `url(${desktopSettings.capsuleIcon1})`;
                        } else {
                            capsuleIcon.style.backgroundImage = 'none';
                        }

                        // 应用所有文本
                        userIdText.textContent = desktopSettings.userId;
                        userHandleText.textContent = '@' + desktopSettings.userHandle;
                        userBioText.textContent = desktopSettings.userBio;
                        userLocationText.textContent = desktopSettings.userLocation;
                        capsuleText.textContent = desktopSettings.capsuleText1;

                        // 【核心新增】应用所有图标的自定义样式
                        applyDesktopIconSettings();
                    }

                    /**
                     * 处理所有桌面图片的上传
                     * @param {Event} event - 文件输入框的 change 事件
                     */
                    function handleDesktopImageUpload(event) {
                        const file = event.target.files[0];
                        if (!file || !currentImageUploadTarget) return;

                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const imageUrl = e.target.result; // 图片的 Base64 Data URL

                            // 根据之前记录的目标，更新设置并保存
                            desktopSettings[currentImageUploadTarget] = imageUrl;
                            saveDesktopSettings();

                            // 立即应用更改
                            applyDesktopSettings();
                        };
                        reader.readAsDataURL(file);
                        desktopFileInput.value = ''; // 清空以便下次上传
                    }

                    /**
                     * 【全新】通用文本原地编辑函数
                     * @param {HTMLElement} element - 要修改的HTML元素
                     * @param {string} settingKey - 在 desktopSettings 中对应的键名
                     * @param {string} defaultValue - 默认文本
                     * @param {boolean} isHandle - 是否是特殊处理的@handle
                     */
                    function editInPlace(element, settingKey, defaultValue, isHandle = false) {
                        // 如果当前已经在编辑中，则阻止再次触发
                        if (element.style.display === 'none') {
                            return;
                        }

                        const originalValue = desktopSettings[settingKey] || defaultValue;

                        element.style.display = 'none'; // 隐藏原始文本

                        const input = document.createElement('input');
                        input.type = 'text';
                        input.value = originalValue;
                        input.className = 'temp-edit-input';

                        if (isHandle) {
                            input.value = desktopSettings[settingKey] || '...';
                        }

                        // 将输入框插入到原始文本后面
                        element.parentNode.insertBefore(input, element.nextSibling);
                        input.focus(); // 自动聚焦
                        input.select(); // 全选文字方便修改

                        // 定义保存和清理函数
                        const saveAndCleanup = () => {
                            const newValue = input.value.trim();
                            const finalValue = (newValue === '') ? defaultValue : newValue;

                            desktopSettings[settingKey] = finalValue;
                            saveDesktopSettings();

                            if (isHandle) {
                                element.textContent = '@' + finalValue;
                            } else {
                                element.textContent = finalValue;
                            }

                            // 移除输入框，显示原始文本
                            input.remove();
                            element.style.display = '';
                        };

                        input.addEventListener('blur', saveAndCleanup); // 当输入框失去焦点时保存
                        input.addEventListener('keypress', (e) => { // 当按下回车时保存
                            if (e.key === 'Enter') {
                                input.blur(); // 触发 blur 事件即可
                            }
                        });
                    }

                    /**
         * 【V1.92 最终性能优化版】根据数据，更新所有相关应用图标的样式
         */
                    function applyDesktopIconSettings() {
                        // 遍历我们已经缓存好的“地图”的key (chat, forum, worldbook, etc.)
                        for (const key in iconConfigMap) {
                            const settings = desktopIconSettings[key] || {};
                            const elements = iconConfigMap[key]; // 直接从“地图”中取出元素列表，不再查询

                            elements.forEach(iconEl => {
                                if (!iconEl) return;

                                // 优先级：URL > 上传图片 > 默认SVG
                                if (settings.url) {
                                    iconEl.style.backgroundImage = `url('${settings.url}')`;
                                    iconEl.style.backgroundSize = 'cover';
                                    iconEl.style.backgroundPosition = 'center';
                                    iconEl.innerHTML = '';
                                } else if (settings.imageUrl) {
                                    iconEl.style.backgroundImage = `url('${settings.imageUrl}')`;
                                    iconEl.style.backgroundSize = 'cover';
                                    iconEl.style.backgroundPosition = 'center';
                                    iconEl.innerHTML = '';
                                } else {
                                    // 恢复默认时，直接从我们的“备份仓库”中取货
                                    iconEl.style.backgroundImage = 'none';
                                    if (defaultIconSVGs[key]) {
                                        iconEl.innerHTML = defaultIconSVGs[key];
                                    }
                                }
                            });
                        }
                    }

                    // 【第一步：缓存】在所有操作开始前，一次性查找并缓存所有图标元素及其默认SVG
                    const iconConfig = [
                        { key: 'chat', elements: document.querySelectorAll('.new-app-icon[data-target="chat-list-screen"], .app-icon-preview[data-icon-key="chat"]') },
                        { key: 'forum', elements: document.querySelectorAll('#main-apps-container .new-app-icon:nth-child(2), .app-icon-preview[data-icon-key="forum"]') },
                        { key: 'worldbook', elements: document.querySelectorAll('.new-app-icon[data-target="world-book-screen"], .app-icon-preview[data-icon-key="worldbook"]') },
                        { key: 'couple', elements: document.querySelectorAll('#main-apps-container .new-app-icon:nth-child(4), .app-icon-preview[data-icon-key="couple"]') },
                        { key: 'settings', elements: document.querySelectorAll('.new-app-icon[data-target="main-settings-screen"], .app-icon-preview[data-icon-key="settings"]') },
                        { key: 'camera', elements: document.querySelectorAll('#bottom-dock .new-app-icon:nth-child(2), .app-icon-preview[data-icon-key="camera"]') },
                        { key: 'message', elements: document.querySelectorAll('#bottom-dock .new-app-icon:nth-child(3), .app-icon-preview[data-icon-key="message"]') },
                        { key: 'phone', elements: document.querySelectorAll('#bottom-dock .new-app-icon:nth-child(4), .app-icon-preview[data-icon-key="phone"]') },
                    ];

                    iconConfig.forEach(config => {
                        // 将查找到的元素列表存入我们的“地图”
                        iconConfigMap[config.key] = config.elements;
                        // 同时，从第一个找到的元素中备份默认SVG
                        if (config.elements.length > 0 && config.elements[0]) {
                            defaultIconSVGs[config.key] = config.elements[0].innerHTML;
                        }
                    });

                    // 4. 这里放事件监听 (Event Listeners)
                    // ===================================================================
                    // 【V1.50 新增】桌面交互事件监听
                    // ===================================================================

                    // 监听全局桌面文件上传工具
                    desktopFileInput.addEventListener('change', handleDesktopImageUpload);

                    // -- 图片上传事件绑定 --
                    userCardBackground.addEventListener('click', () => {
                        currentImageUploadTarget = 'userBackground';
                        desktopFileInput.click();
                    });
                    userCardAvatar.addEventListener('click', () => {
                        currentImageUploadTarget = 'userAvatar';
                        desktopFileInput.click();
                    });
                    recordInner.addEventListener('click', () => {
                        currentImageUploadTarget = 'recordInner';
                        desktopFileInput.click();
                    });
                    capsuleIcon.addEventListener('click', () => {
                        currentImageUploadTarget = 'capsuleIcon1';
                        desktopFileInput.click();
                    });

                    // -- 文本编辑事件绑定 (已全部更新为新版) --
                    userIdText.addEventListener('click', () => {
                        editInPlace(userIdText, 'userId', 'Name');
                    });
                    userHandleText.addEventListener('click', () => {
                        editInPlace(userHandleText, 'userHandle', '...', true);
                    });
                    userBioText.addEventListener('click', () => {
                        editInPlace(userBioText, 'userBio', '自定义文案');
                    });
                    userLocationText.addEventListener('click', () => {
                        editInPlace(userLocationText, 'userLocation', '...');
                    });
                    capsuleText.addEventListener('click', () => {
                        editInPlace(capsuleText, 'capsuleText1', '');
                    });
                    // 【新增】更新状态栏时间
                    function updateTime() {
                        const timeEl = document.getElementById('status-bar-time');
                        if (timeEl) {
                            const now = new Date();
                            const hours = String(now.getHours()).padStart(2, '0');
                            const minutes = String(now.getMinutes()).padStart(2, '0');
                            timeEl.textContent = `${hours}:${minutes}`;
                        }
                    }

                    // 启动时间更新
                    updateTime(); // 立即运行一次
                    setInterval(updateTime, 1000); // 之后每秒运行一次
                    // 5. 启动加载
                    loadDesktopSettings();
                });
            </script>
</body>

</html>